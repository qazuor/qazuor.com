---
import { getCollection } from 'astro:content';
import AboutSection from '../../components/AboutSection.astro';
import BlogSection from '../../components/BlogSection.astro';
import { Contact } from '../../components/Contact';
import HeroSection from '../../components/HeroSection.astro';
import ProjectsSection from '../../components/ProjectsSection.astro';
import SkillsSection from '../../components/SkillsSection.astro';
import { languages } from '../../i18n/ui';
import { getLangFromUrl, getTranslations } from '../../i18n/utils';
import BaseLayout from '../../layouts/BaseLayout.astro';

export function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

const lang = getLangFromUrl(Astro.url);
const t = getTranslations(lang);

const title = 'qazuor - Full-Stack Developer';
const description = 'Building beautiful, performant, and accessible web experiences';

// Load Content Collections
const allProjects = await getCollection('projects');
const allBlogPosts = await getCollection('blog');

// Sort projects by order field, then by date
const sortedProjects = allProjects
  .sort((a, b) => {
    if (a.data.order !== b.data.order) {
      return a.data.order - b.data.order;
    }
    return b.data.publishDate.getTime() - a.data.publishDate.getTime();
  })
  .map((project) => ({
    title: project.data.title,
    description: project.data.description,
    tags: project.data.tags,
    image: project.data.image,
    demoUrl: project.data.demoUrl,
    codeUrl: project.data.codeUrl,
    featured: project.data.featured,
  }));

// Sort blog posts by date (newest first) and filter out drafts
const sortedBlogPosts = allBlogPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .map((post) => ({
    title: post.data.title,
    excerpt: post.data.excerpt,
    date: post.data.publishDate.toISOString().split('T')[0],
    readTime: post.data.readTime,
    tags: post.data.tags,
    slug: `/${lang}/blog/${post.slug}`,
  }));

// Translations for components
const heroTranslations = {
  viewProjects: t('home.hero.viewProjects'),
  getInTouch: t('home.hero.getInTouch'),
  scroll: t('home.hero.scroll'),
};

const aboutTranslations = {
  title: t('about.title'),
  subtitle: t('about.subtitle'),
  connect: t('about.connect'),
};

const skillsTranslations = {
  title: t('skills.title'),
  subtitle: t('skills.subtitle'),
  categoryTitles: {
    frontend: t('skills.categories.frontend'),
    backend: t('skills.categories.backend'),
    tools: t('skills.categories.tools'),
  },
};

const projectsTranslations = {
  title: t('projects.title'),
  subtitle: t('projects.subtitle'),
  noProjects: t('projects.noProjects'),
  filterAll: t('projects.filterAll'),
};

const projectCardTranslations = {
  demo: t('projects.viewDemo'),
  code: t('projects.viewCode'),
  featured: t('projects.featured'),
};

const blogTranslations = {
  title: t('blog.title'),
  subtitle: t('blog.subtitle'),
  viewAll: t('blog.viewAll'),
  noArticles: t('blog.noArticles'),
  readMore: t('blog.readMore'),
};

const blogCardTranslations = {
  readMore: t('blog.readMore'),
};

const contactTranslations = {
  title: t('contact.title'),
  subtitle: t('contact.subtitle'),
  form: {
    name: t('contact.form.name'),
    email: t('contact.form.email'),
    subject: t('contact.form.subject'),
    message: t('contact.form.message'),
    send: t('contact.form.send'),
    sending: t('contact.form.sending'),
  },
  placeholders: {
    name: t('contact.placeholders.name'),
    email: t('contact.placeholders.email'),
    subject: t('contact.placeholders.subject'),
    message: t('contact.placeholders.message'),
  },
  errors: {
    nameRequired: t('contact.errors.nameRequired'),
    emailRequired: t('contact.errors.emailRequired'),
    emailInvalid: t('contact.errors.emailInvalid'),
    subjectRequired: t('contact.errors.subjectRequired'),
    messageRequired: t('contact.errors.messageRequired'),
    messageMinLength: t('contact.errors.messageMinLength'),
  },
  success: t('contact.success'),
  error: t('contact.error'),
};
---

<BaseLayout title={title} description={description}>
  <!-- Hero Section -->
  <HeroSection
    name="qazuor"
    roles={[
      t('home.roles.fullstack'),
      t('home.roles.react'),
      t('home.roles.uiux'),
      t('home.roles.solver'),
    ]}
    subtitle={t('home.hero.subtitle')}
    translations={heroTranslations}
  />

  <!-- About Section -->
  <AboutSection
    name="qazuor"
    role={t('home.roles.fullstack')}
    location="Remote"
    experience="5+ years"
    email="hello@qazuor.com"
    availability={t('about.availability')}
    bio={t('about.bio')}
    translations={aboutTranslations}
  />

  <!-- Skills Section -->
  <SkillsSection translations={skillsTranslations} />

  <!-- Projects Section -->
  <ProjectsSection projects={sortedProjects} translations={projectsTranslations} cardTranslations={projectCardTranslations} />

  <!-- Blog Section -->
  <BlogSection
    posts={sortedBlogPosts}
    translations={{
      ...blogTranslations,
      readMore: blogCardTranslations.readMore,
    }}
    lang={lang}
  />

  <!-- Contact Section -->
  <Contact client:load translations={contactTranslations} />
</BaseLayout>
