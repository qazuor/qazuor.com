---
/**
 * ComparisonSection - Service comparison table
 * Shows a responsive comparison of all 6 services
 * Desktop: horizontal table, Mobile: stacked cards
 * Data comes from services.ts, only labels from translations
 */

import SectionTitle from '@/components/ui/SectionTitle.astro';
import { serviceColors as serviceColorConfig } from '@/data/serviceColors';
import { type ServiceComparison, services } from '@/data/services';

interface Props {
    lang: string;
    translations: {
        title: string;
        subtitle: string;
        headers: {
            feature: string;
            webApps: string;
            landingPages: string;
            automation: string;
            socialDesign: string;
            webOptimization: string;
            wordpress: string;
        };
        labels: {
            timeline: string;
            priceRange: string;
            maintenance: string;
            complexity: string;
            bestFor: string;
            weeks: string;
            consultation: string;
            from: string;
        };
        maintenance: {
            recommended: string;
            optional: string;
            'not-needed': string;
        };
        complexity: {
            low: string;
            'low-medium': string;
            medium: string;
            'medium-high': string;
            high: string;
            'low-high': string;
        };
        bestFor: {
            customSolutions: string;
            marketingSeo: string;
            efficiency: string;
            brandPresence: string;
            seoPerformance: string;
            blogsEcommerce: string;
        };
        cta: {
            notSure: string;
            contact: string;
        };
    };
}

const { lang, translations } = Astro.props;

// Service column colors - mapped from centralized serviceColors config
// This ensures consistency across all service-related pages
const serviceColors: Record<string, { bg: string; border: string; text: string; header: string }> = Object.fromEntries(
    Object.entries(serviceColorConfig).map(([id, config]) => [
        id,
        {
            bg: config.tailwind.bgLight,
            border: config.tailwind.border,
            text: config.tailwind.textDark,
            header: config.tailwind.bgMedium
        }
    ])
);

// Map service id to header translation key
const serviceHeaderKeys: Record<string, keyof typeof translations.headers> = {
    'web-apps': 'webApps',
    'landing-pages': 'landingPages',
    'automation-integration': 'automation',
    'social-media-design': 'socialDesign',
    'web-optimization': 'webOptimization',
    wordpress: 'wordpress'
};

// Format timeline from data
function formatTimeline(comparison: ServiceComparison): string {
    const { minWeeks, maxWeeks } = comparison.timeline;
    if (maxWeeks) {
        return `${minWeeks}-${maxWeeks} ${translations.labels.weeks}`;
    }
    return `${translations.labels.from} ${minWeeks} ${translations.labels.weeks}`;
}

// Format price range from data
function formatPriceRange(comparison: ServiceComparison): string {
    const { type, min, max, currency } = comparison.priceRange;
    if (type === 'consultation') {
        return translations.labels.consultation;
    }
    if (type === 'from') {
        return `${translations.labels.from} ${currency} ${min?.toLocaleString()}`;
    }
    // type === 'range'
    return `${currency} ${min?.toLocaleString()} - ${max?.toLocaleString()}+`;
}

// Get maintenance label
function getMaintenanceLabel(comparison: ServiceComparison): string {
    return translations.maintenance[comparison.maintenance];
}

// Get complexity label
function getComplexityLabel(comparison: ServiceComparison): string {
    return translations.complexity[comparison.complexity];
}

// Get best for label
function getBestForLabel(comparison: ServiceComparison): string {
    return translations.bestFor[comparison.bestForKey as keyof typeof translations.bestFor];
}

// Build rows from services data
const rows = [
    { label: translations.labels.timeline, getValue: formatTimeline },
    { label: translations.labels.priceRange, getValue: formatPriceRange },
    { label: translations.labels.maintenance, getValue: getMaintenanceLabel },
    { label: translations.labels.complexity, getValue: getComplexityLabel },
    { label: translations.labels.bestFor, getValue: getBestForLabel }
];
---

<div class="comparison-section py-16">
    <div class="container-custom">
        <!-- Section Title -->
        <SectionTitle title={translations.title} subtitle={translations.subtitle} />

        <!-- Desktop Table (hidden on mobile) -->
        <div class="hidden lg:block mt-12 overflow-x-auto">
            <table class="w-full border-collapse">
                <!-- Header Row -->
                <thead>
                    <tr>
                        <th class="p-4 text-left text-foreground-secondary font-medium bg-foreground/5 rounded-tl-xl border-b border-foreground/10">
                            {translations.headers.feature}
                        </th>
                        {services.map((service, index) => {
                            const colors = serviceColors[service.id];
                            const headerKey = serviceHeaderKeys[service.id];
                            const isLast = index === services.length - 1;
                            return (
                                <th class={`p-4 text-center font-bold ${colors.header} ${colors.text} border-b ${colors.border} ${isLast ? 'rounded-tr-xl' : ''}`}>
                                    <a href={`/${lang}/services/${service.slug}`} class="hover:underline">
                                        {translations.headers[headerKey]}
                                    </a>
                                </th>
                            );
                        })}
                    </tr>
                </thead>

                <!-- Body Rows -->
                <tbody>
                    {rows.map((row, rowIndex) => {
                        const isLast = rowIndex === rows.length - 1;
                        return (
                            <tr class="border-b border-foreground/10 last:border-0">
                                <td class={`p-4 text-foreground font-medium bg-foreground/5 ${isLast ? 'rounded-bl-xl' : ''}`}>
                                    {row.label}
                                </td>
                                {services.map((service, colIndex) => {
                                    const colors = serviceColors[service.id];
                                    const isLastCol = colIndex === services.length - 1;
                                    return (
                                        <td class={`p-4 text-center text-foreground-secondary ${colors.bg} border-l ${colors.border} ${isLast && isLastCol ? 'rounded-br-xl' : ''}`}>
                                            {row.getValue(service.comparison)}
                                        </td>
                                    );
                                })}
                            </tr>
                        );
                    })}
                </tbody>
            </table>
        </div>

        <!-- Mobile Cards (hidden on desktop) -->
        <div class="lg:hidden mt-8 space-y-6">
            {services.map((service) => {
                const colors = serviceColors[service.id];
                const headerKey = serviceHeaderKeys[service.id];
                return (
                    <div class={`rounded-xl border ${colors.border} overflow-hidden`}>
                        <!-- Card Header -->
                        <div class={`p-4 ${colors.header}`}>
                            <a href={`/${lang}/services/${service.slug}`} class={`text-lg font-bold ${colors.text} hover:underline`}>
                                {translations.headers[headerKey]}
                            </a>
                        </div>

                        <!-- Card Body -->
                        <div class={`${colors.bg} divide-y divide-foreground/10`}>
                            {rows.map((row) => (
                                <div class="flex justify-between items-center p-4">
                                    <span class="text-foreground-secondary text-sm">{row.label}</span>
                                    <span class="text-foreground font-medium">{row.getValue(service.comparison)}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            })}
        </div>

        <!-- CTA -->
        <div class="mt-12 text-center p-6 rounded-xl bg-foreground/5 border border-foreground/10">
            <p class="text-foreground-secondary mb-4">{translations.cta.notSure}</p>
            <a
                href={`/${lang}/#contact`}
                class="inline-flex items-center px-6 py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark transition-colors duration-200"
            >
                {translations.cta.contact}
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.959 8.959 0 01-4.906-1.478L3 21l2.478-5.094A8.959 8.959 0 013 12c0-4.418 3.582-8 8-8s8 3.582 8 8z" />
                </svg>
            </a>
        </div>
    </div>
</div>

<style>
    .comparison-section {
        background: linear-gradient(
            180deg,
            transparent 0%,
            hsl(var(--color-primary) / 0.02) 50%,
            transparent 100%
        );
    }
</style>
