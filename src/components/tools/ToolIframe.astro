---
import SecondaryTitle from '../ui/SecondaryTitle.astro';

interface Props {
  src: string;
  toolName: string;
  height?: string;
  className?: string;
}

const { src, toolName, height = '600px', className = '' } = Astro.props;
---

<div class={`tool-iframe-wrapper ${className}`}>
  <!-- Header with tool name and external link -->
  <div class="tool-header flex justify-between items-center p-4 border-b border-foreground/10">
    <SecondaryTitle text={toolName} size="sm" showHtml={false} />
    <a
      href={src}
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center gap-2 text-sm text-primary hover:text-primary-hover transition-colors"
      aria-label={`Open ${toolName} in new tab`}
    >
      <span>Open in new tab</span>
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
      </svg>
    </a>
  </div>

  <!-- iFrame container -->
  <div class="tool-iframe-container relative bg-background-secondary rounded-lg overflow-hidden">
    <!-- Loading state -->
    <div
      class="loading-overlay absolute inset-0 flex items-center justify-center bg-background-secondary"
    >
      <div class="flex flex-col items-center gap-4">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
        <p class="text-sm text-foreground-secondary">Loading {toolName}...</p>
      </div>
    </div>

    <!-- iFrame -->
    <iframe
      src={src}
      width="100%"
      height={height}
      title={toolName}
      loading="lazy"
      allow="clipboard-write"
      sandbox="allow-scripts allow-same-origin allow-forms"
      class="w-full border-0"
      onload="this.parentElement.querySelector('.loading-overlay').style.display='none'"></iframe>
  </div>

  <!-- Tool info footer -->
  <div class="tool-footer p-3 bg-foreground/5 text-xs text-foreground-secondary">
    <p>
      This tool runs independently and doesn't affect your browser's performance.
      <span class="ml-2">
        <a href={src} target="_blank" class="text-primary hover:underline"> View source â†— </a>
      </span>
    </p>
  </div>
</div>

<style>
  .tool-iframe-wrapper {
    @apply border border-foreground/10 rounded-lg overflow-hidden bg-background;
    max-width: 100%;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  .tool-iframe-container {
    position: relative;
    min-height: 400px;
  }

  .loading-overlay {
    transition: opacity 0.3s ease;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .tool-iframe-wrapper {
      margin: 0 -1rem;
      border-radius: 0;
      border-left: 0;
      border-right: 0;
    }
  }
</style>
