---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';
import photoFooter from '@/assets/images/photo-footer.png';
import SocialLinks from '@/components/ui/SocialLinks.astro';
import { contact } from '@/data/contact';
import { getTranslations, processMarkdown } from '@/i18n/utils';

interface Props {
    lang?: 'en' | 'es';
}

const { lang = 'en' } = Astro.props;
const t = getTranslations(lang);

// Get latest blog posts
const allBlogPosts = await getCollection('blog');
const latestPosts: CollectionEntry<'blog'>[] = allBlogPosts
    .filter((post: CollectionEntry<'blog'>) => !post.data.draft)
    .sort(
        (a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) =>
            b.data.publishDate.getTime() - a.data.publishDate.getTime()
    )
    .slice(0, 4);

// Footer data
const footerData = {
    en: {
        branding: {
            title: 'Qazuor',
            description:
                "I'm a **full-stack** developer with a strong **frontend** focus, dedicated to building modern, fast and accessible web experiences.\n\nI help companies and entrepreneurs turn ideas into **clear digital products**, combining clean **code**, solid **design** and decisions made with scaling in mind."
        },
        explore: {
            title: 'Explore',
            items: [
                { name: 'Services', url: '/en/services' },
                { name: 'Projects', url: '/en/projects' },
                { name: 'Blog', url: '/en/blog' },
                { name: 'Goodies', url: '/en/goodies' }
            ]
        },
        latestPosts: {
            title: 'Latest posts',
            viewAll: 'View all posts'
        },
        contact: {
            title: 'Contact me',
            email: contact.email,
            phone: contact.phone
        },
        madeWith: 'Made with ðŸ’™ with Astro'
    },
    es: {
        branding: {
            title: 'Qazuor',
            description:
                'Soy un desarrollador **full-stack** con foco en **frontend**, enfocado en crear experiencias web modernas, rÃ¡pidas y accesibles.\n\nAyudo a empresas y emprendedores a convertir ideas en **productos digitales claros**, combinando **code** limpio, buen **diseÃ±o** y decisiones pensadas para escalar.'
        },
        explore: {
            title: 'Explorar',
            items: [
                { name: 'Servicios', url: '/es/services' },
                { name: 'Proyectos', url: '/es/projects' },
                { name: 'Blog', url: '/es/blog' },
                { name: 'Goodies', url: '/es/goodies' }
            ]
        },
        latestPosts: {
            title: 'Ãšltimos posts',
            viewAll: 'Ver todos los posts'
        },
        contact: {
            title: 'ContÃ¡ctame',
            email: contact.email,
            phone: contact.phone
        },
        madeWith: 'Hecho con ðŸ’™ con Astro'
    }
};

const currentYear = new Date().getFullYear();
const data = footerData[lang];
---

<footer class="relative z-40 py-16 md:py-20" style="background-color: var(--section-footer-bg)">
    <div class="container-custom">
        <!-- Main Footer Content -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-10 mb-6 lg:mb-12">
            <!-- Branding / About with positioned image -->
            <div class="sm:col-span-2 relative">
                <h3 class="text-lg font-semibold text-foreground mb-4 lg:pl-64">
                    {data.branding.title}
                    <span class="text-foreground-muted">â€”</span>
                </h3>
                <p class="text-xs text-foreground-muted leading-relaxed lg:pl-64" set:html={processMarkdown(data.branding.description)} />
                <!-- Image positioned to extend to the bottom divider -->
                <Image
                    src={photoFooter}
                    alt={t('imageAlt.footerPhoto')}
                    width={280}
                    height={280}
                    class="hidden lg:block absolute left-0 -bottom-12 w-56 h-auto"
                />
            </div>

            <!-- Latest Posts -->
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-foreground">
                    {data.latestPosts.title}
                    <span class="text-foreground-muted">â€”</span>
                </h3>
                <ul class="space-y-2">
                    {
                        latestPosts.map((post) => (
                            <li>
                                <a
                                    href={`/${lang}/blog/${post.slug}`}
                                    class="text-xs text-foreground-muted hover:text-primary transition-colors duration-base line-clamp-1"
                                >
                                    {post.data.title}
                                </a>
                            </li>
                        ))
                    }
                    <li>
                        <a
                            href={`/${lang}/blog`}
                            class="text-xs text-primary hover:text-primary/80 transition-colors duration-base font-medium"
                        >
                            {data.latestPosts.viewAll} â†’
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Explore + Contact combined -->
            <div class="space-y-6">
                <!-- Explore / Navigation -->
                <div class="space-y-3">
                    <h3 class="text-lg font-semibold text-foreground">
                        {data.explore.title}
                        <span class="text-foreground-muted">â€”</span>
                    </h3>
                    <ul class="space-y-1">
                        {
                            data.explore.items.map((item) => (
                                <li>
                                    <a
                                        href={item.url}
                                        class="text-xs text-foreground-muted hover:text-primary transition-colors duration-base"
                                    >
                                        {item.name}
                                    </a>
                                </li>
                            ))
                        }
                    </ul>
                </div>

                <!-- Contact -->
                <div class="space-y-3">
                    <h3 class="text-lg font-semibold text-foreground">
                        {data.contact.title}
                        <span class="text-foreground-muted">â€”</span>
                    </h3>
                    <div class="space-y-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-foreground-muted">E:</span>
                            <a
                                href={`mailto:${data.contact.email}`}
                                class="text-xs text-foreground hover:text-primary transition-colors duration-base"
                            >
                                {data.contact.email}
                            </a>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-foreground-muted">P:</span>
                            <span class="text-xs text-foreground-muted">{data.contact.phone}</span>
                        </div>
                    </div>
                    <SocialLinks
                        ariaLabels={{
                            github: t('aria.github'),
                            linkedin: t('aria.linkedin'),
                            fiverr: t('aria.fiverr'),
                            upwork: t('aria.upwork'),
                            whatsapp: t('aria.whatsapp'),
                            mail: t('aria.mail'),
                            buymeacoffee: t('aria.buymeacoffee')
                        }}
                        size="sm"
                    />
                </div>
            </div>
        </div>

        <!-- Mobile Photo - positioned absolute, flipped -->
        <Image
            src={photoFooter}
            alt={t('imageAlt.footerPhoto')}
            width={180}
            height={180}
            class="lg:hidden absolute right-4 bottom-[130px] w-36 h-auto scale-x-[-1]"
        />

        <!-- Bottom Footer -->
        <div class="pt-8 border-t border-foreground/10">
            <div class="flex items-center justify-center gap-2">
                <div class="w-8 h-8 rounded-full bg-foreground/10 flex items-center justify-center">
                    <span class="text-sm font-medium text-foreground">Q</span>
                </div>
                <span class="text-xs text-foreground-muted">
                    Â© {currentYear} Qazuor. {data.madeWith}
                </span>
            </div>
        </div>
    </div>
</footer>

<style>
    /* Custom hover effects */
    footer a:hover {
        transform: translateY(-1px);
    }
</style>
