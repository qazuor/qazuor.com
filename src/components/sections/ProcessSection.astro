---
/**
 * ProcessSection - Horizontal timeline showing the development process
 * Displays 6 steps: Discovery → Planning → Design → Development → Testing → Launch
 * Responsive: horizontal timeline on desktop, vertical on mobile
 */

import SectionTitle from '@/components/ui/SectionTitle.astro';
import { processSteps } from '@/data/process';

interface ProcessStepTranslation {
    title: string;
    description: string;
}

interface Props {
    translations: {
        title: string;
        subtitle: string;
        steps: Record<string, ProcessStepTranslation>;
    };
}

const { translations } = Astro.props;

// Dynamic imports for process icons
const iconImports: Record<string, string> = {
    'magnifying-glass-circle': (await import('@/icons/ui/magnifying-glass-circle.svg?raw')).default,
    'clipboard-document-list': (await import('@/icons/ui/clipboard-document-list.svg?raw')).default,
    'paint-brush': (await import('@/icons/ui/paint-brush.svg?raw')).default,
    'code-bracket': (await import('@/icons/ui/code-bracket.svg?raw')).default,
    beaker: (await import('@/icons/ui/beaker.svg?raw')).default,
    'rocket-launch': (await import('@/icons/ui/rocket-launch.svg?raw')).default
};

// Color palette for steps - uses CSS variables from global.css
// To change colors, edit --process-step-{n} variables in global.css
const stepColors = [
    {
        bg: 'bg-[rgba(var(--process-step-1),0.2)]',
        border: 'border-[rgba(var(--process-step-1),0.5)]',
        text: 'text-[rgb(var(--process-step-1))]',
        dot: 'bg-[rgb(var(--process-step-1))]'
    },
    {
        bg: 'bg-[rgba(var(--process-step-2),0.2)]',
        border: 'border-[rgba(var(--process-step-2),0.5)]',
        text: 'text-[rgb(var(--process-step-2))]',
        dot: 'bg-[rgb(var(--process-step-2))]'
    },
    {
        bg: 'bg-[rgba(var(--process-step-3),0.2)]',
        border: 'border-[rgba(var(--process-step-3),0.5)]',
        text: 'text-[rgb(var(--process-step-3))]',
        dot: 'bg-[rgb(var(--process-step-3))]'
    },
    {
        bg: 'bg-[rgba(var(--process-step-4),0.2)]',
        border: 'border-[rgba(var(--process-step-4),0.5)]',
        text: 'text-[rgb(var(--process-step-4))]',
        dot: 'bg-[rgb(var(--process-step-4))]'
    },
    {
        bg: 'bg-[rgba(var(--process-step-5),0.2)]',
        border: 'border-[rgba(var(--process-step-5),0.5)]',
        text: 'text-[rgb(var(--process-step-5))]',
        dot: 'bg-[rgb(var(--process-step-5))]'
    },
    {
        bg: 'bg-[rgba(var(--process-step-6),0.2)]',
        border: 'border-[rgba(var(--process-step-6),0.5)]',
        text: 'text-[rgb(var(--process-step-6))]',
        dot: 'bg-[rgb(var(--process-step-6))]'
    }
];
---

<div class="process-section py-16">
    <div class="container-custom">
        <!-- Section Title -->
        <SectionTitle title={translations.title} subtitle={translations.subtitle} />

        <!-- Desktop Timeline (horizontal) -->
        <div class="hidden lg:block mt-12">
            <!-- Timeline Line -->
            <div class="relative">
                <!-- Connector line (z-0 stays behind step boxes which have z-10 + opaque bg) -->
                <div
                    class="absolute top-12 left-0 right-0 h-0.5 opacity-30 z-0"
                    style="background: linear-gradient(to right, var(--process-step-1-full), var(--process-step-3-full), var(--process-step-5-full));"
                />

                <!-- Steps -->
                <div class="grid grid-cols-6 gap-4">
                    {processSteps.map((step, index) => {
                        const stepTranslation = translations.steps[step.id];
                        const colors = stepColors[index];
                        const iconSvg = iconImports[step.iconId];

                        return (
                            <div class="relative flex flex-col items-center text-center group">
                                <!-- Step Number + Icon -->
                                <div
                                    class={`relative z-10 w-24 h-24 rounded-2xl bg-background ${colors.border} border-2 flex flex-col items-center justify-center transition-all duration-base group-hover:scale-emphasis group-hover:shadow-lg group-hover:shadow-primary/20 overflow-hidden`}
                                >
                                    <!-- Color overlay -->
                                    <div class={`absolute inset-0 ${colors.bg}`} />
                                    <span class={`relative z-10 text-xs font-bold ${colors.text} mb-1`}>
                                        {String(step.number).padStart(2, '0')}
                                    </span>
                                    <div class={`relative z-10 w-8 h-8 ${colors.text}`} set:html={iconSvg} />
                                </div>

                                <!-- Dot on timeline -->
                                <div class={`absolute top-[88px] w-3 h-3 rounded-full ${colors.dot} ring-4 ring-background z-20`} />

                                <!-- Title -->
                                <h3 class="mt-8 text-lg font-bold text-foreground">{stepTranslation.title}</h3>

                                <!-- Description -->
                                <p class="mt-2 text-sm text-foreground-secondary leading-relaxed px-2">
                                    {stepTranslation.description}
                                </p>
                            </div>
                        );
                    })}
                </div>
            </div>
        </div>

        <!-- Mobile Timeline (vertical) -->
        <div class="lg:hidden mt-8">
            <div class="relative">
                <!-- Vertical line -->
                <div
                    class="absolute left-6 top-0 bottom-0 w-0.5 opacity-30"
                    style="background: linear-gradient(to bottom, var(--process-step-1-full), var(--process-step-3-full), var(--process-step-5-full))"
                />

                <!-- Steps -->
                <div class="space-y-8">
                    {processSteps.map((step, index) => {
                        const stepTranslation = translations.steps[step.id];
                        const colors = stepColors[index];
                        const iconSvg = iconImports[step.iconId];

                        return (
                            <div class="relative flex items-start gap-6 pl-2">
                                <!-- Icon container -->
                                <div
                                    class={`relative z-10 flex-shrink-0 w-12 h-12 rounded-xl ${colors.bg} ${colors.border} border flex items-center justify-center`}
                                >
                                    <div class={`w-6 h-6 ${colors.text}`} set:html={iconSvg} />
                                </div>

                                <!-- Content -->
                                <div class="flex-1 pb-2">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class={`text-xs font-bold ${colors.text}`}>
                                            {String(step.number).padStart(2, '0')}
                                        </span>
                                        <h3 class="text-lg font-bold text-foreground">{stepTranslation.title}</h3>
                                    </div>
                                    <p class="text-sm text-foreground-secondary leading-relaxed">
                                        {stepTranslation.description}
                                    </p>
                                </div>
                            </div>
                        );
                    })}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .process-section {
        background: linear-gradient(
            180deg,
            transparent 0%,
            hsl(var(--color-primary) / 0.03) 50%,
            transparent 100%
        );
    }
</style>
