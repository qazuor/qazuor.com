---
/**
 * BlogPostJsonLd Component
 * Renders structured data for blog post pages
 *
 * Includes:
 * - BlogPosting schema with author, date, description
 * - BreadcrumbList for navigation
 *
 * @example
 * <BlogPostJsonLd
 *   lang="en"
 *   title="My Blog Post"
 *   description="A short description"
 *   publishDate="2024-01-15"
 *   modifiedDate="2024-01-20"
 *   author="Julian Cataldo"
 *   url="https://qazuor.com/en/blog/my-post"
 *   image="https://qazuor.com/images/post.jpg"
 *   tags={["react", "typescript"]}
 *   wordCount={1500}
 *   articleSection="Technology"
 * />
 */
import type { BlogPostingSchema, BreadcrumbListSchema } from '@/types/jsonld';
import JsonLd from './JsonLd.astro';

interface Props {
    lang: string;
    title: string;
    description: string;
    publishDate: Date;
    modifiedDate?: Date;
    author?: string;
    url: string;
    image?: string;
    tags?: string[];
    wordCount?: number;
    articleSection?: string;
}

const {
    lang,
    title,
    description,
    publishDate,
    modifiedDate,
    author = 'Julian Cataldo',
    url,
    image,
    tags = [],
    wordCount,
    articleSection
} = Astro.props;

const SITE_URL = 'https://qazuor.com';

// Format dates to ISO string
const formatDate = (date: Date): string => date.toISOString();

// Build BlogPosting schema
const blogSchema: BlogPostingSchema = {
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    headline: title,
    description: description,
    url: url,
    mainEntityOfPage: url,
    datePublished: formatDate(publishDate),
    ...(modifiedDate && { dateModified: formatDate(modifiedDate) }),
    author: {
        '@type': 'Person',
        name: author
    },
    publisher: {
        '@type': 'Person',
        name: author
    },
    ...(image && { image: image }),
    ...(tags.length > 0 && { keywords: tags }),
    ...(wordCount && { wordCount: wordCount }),
    ...(articleSection && { articleSection: articleSection }),
    inLanguage: lang
};

// Build Breadcrumb schema
const breadcrumbSchema: BreadcrumbListSchema = {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: [
        {
            '@type': 'ListItem',
            position: 1,
            name: lang === 'es' ? 'Inicio' : 'Home',
            item: `${SITE_URL}/${lang}`
        },
        {
            '@type': 'ListItem',
            position: 2,
            name: 'Blog',
            item: `${SITE_URL}/${lang}/blog`
        },
        {
            '@type': 'ListItem',
            position: 3,
            name: title
        }
    ]
};

// Combine all schemas
const schemas = [blogSchema, breadcrumbSchema];
---

<JsonLd schema={schemas} />
