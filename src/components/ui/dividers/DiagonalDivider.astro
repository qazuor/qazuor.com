---
/**
 * DiagonalDivider Component
 * @param {string} nextSectionColor - Color de la siguiente sección (formato hex: "#RRGGBB")
 * @param {string} upperSectionColor - Color de la sección superior (formato hex: "#RRGGBB")
 * @param {("right"|"left"|"mixed")} [direction="mixed"] - Dirección de las líneas diagonales:
 *   - "right": Todas las líneas bajan hacia la derecha
 *   - "left": Todas las líneas bajan hacia la izquierda
 *   - "mixed": Mezcla de ambas direcciones (por defecto)
 */

interface Props {
  nextSectionColor: string;
  upperSectionColor: string;
  direction?: 'right' | 'left' | 'mixed';
}

const { nextSectionColor, upperSectionColor, direction = 'mixed' } = Astro.props;

function interpolateColor(color1: string, color2: string, factor: number): string {
  const hex1 = color1.replace('#', '');
  const hex2 = color2.replace('#', '');

  const r1 = Number.parseInt(hex1.substring(0, 2), 16);
  const g1 = Number.parseInt(hex1.substring(2, 4), 16);
  const b1 = Number.parseInt(hex1.substring(4, 6), 16);

  const r2 = Number.parseInt(hex2.substring(0, 2), 16);
  const g2 = Number.parseInt(hex2.substring(2, 4), 16);
  const b2 = Number.parseInt(hex2.substring(4, 6), 16);

  const r = Math.round(r1 + (r2 - r1) * factor);
  const g = Math.round(g1 + (g2 - g1) * factor);
  const b = Math.round(b1 + (b2 - b1) * factor);

  return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
}

const color1 = interpolateColor(upperSectionColor, nextSectionColor, 0.2);
const color2 = interpolateColor(upperSectionColor, nextSectionColor, 0.4);
const color3 = interpolateColor(upperSectionColor, nextSectionColor, 0.6);
const color4 = interpolateColor(upperSectionColor, nextSectionColor, 0.8);
const color5 = nextSectionColor;

const getPoints = (startY: number, endY: number, goingRight: boolean) => {
  if (goingRight) {
    return `-15000,${startY} 15000,${endY} 15000,80 -15000,80`;
  }
  return `-15000,${endY} 15000,${startY} 15000,80 -15000,80`;
};

const line1Right = direction === 'right' || direction === 'mixed';
const line2Right = direction === 'right';
const line3Right = direction === 'right' || direction === 'mixed';
const line4Right = direction === 'right';
---

<div class="diagonal-divider">
  <div class="relative w-full h-20 md:h-24">
    <svg
      class="absolute inset-0 w-full h-full"
      viewBox="-15000 0 30000 80"
      preserveAspectRatio="none"
    >
      <g opacity="0.4">
        <polygon points={getPoints(0, 38, line1Right)} fill={color1}>
          <animateTransform
            attributeName="transform"
            type="translate"
            values="0,0; 30,2; 0,0"
            dur="12s"
            repeatCount="indefinite"></animateTransform>
        </polygon>
      </g>

      <g opacity="0.5">
        <polygon points={getPoints(12, 55, line2Right)} fill={color2}>
          <animateTransform
            attributeName="transform"
            type="translate"
            values="0,0; -25,3; 0,0"
            dur="10s"
            repeatCount="indefinite"></animateTransform>
        </polygon>
      </g>

      <g opacity="0.6">
        <polygon points={getPoints(20, 48, line3Right)} fill={color3}>
          <animateTransform
            attributeName="transform"
            type="translate"
            values="0,0; 28,2; 0,0"
            dur="14s"
            repeatCount="indefinite"></animateTransform>
        </polygon>
      </g>

      <g opacity="0.75">
        <polygon points={getPoints(28, 62, line4Right)} fill={color4}>
          <animateTransform
            attributeName="transform"
            type="translate"
            values="0,0; -20,3; 0,0"
            dur="9s"
            repeatCount="indefinite"></animateTransform>
        </polygon>
      </g>

      <polygon points={getPoints(35, 70, line1Right)} fill={color5}></polygon>
    </svg>
  </div>
</div>

<style>
  .diagonal-divider {
    @apply absolute left-0 right-0 -bottom-1 z-10 overflow-hidden leading-none pointer-events-none;
  }
</style>
