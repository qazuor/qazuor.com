---
import { getCollection } from 'astro:content';
import { Contact } from '../../components/forms/Contact';
import AboutSection from '../../components/sections/AboutSection.astro';
import BlogSection from '../../components/sections/BlogSection.astro';
import HeroSection from '../../components/sections/HeroSection.astro';
import ProjectsSection from '../../components/sections/ProjectsSection.astro';
import SkillsSection from '../../components/sections/SkillsSection.astro';
import TestimonialsSection from '../../components/sections/TestimonialsSection.astro';
import DiagonalDivider from '../../components/ui/dividers/DiagonalDivider.astro';
import WaveDivider from '../../components/ui/dividers/WaveDivider.astro';
import ZigzagDivider from '../../components/ui/dividers/ZigZagDivider.astro';
import { contact, sectionsColors } from '../../data';
import { languages } from '../../i18n/ui';
import { getLangFromUrl, getTranslations } from '../../i18n/utils';
import BaseLayout from '../../layouts/BaseLayout.astro';

export function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

const lang = getLangFromUrl(Astro.url);
const t = getTranslations(lang);

const title = t('seo.title');
const description = t('home.description');

// SEO keywords - definidos directamente ya que las traducciones no manejan bien arrays
const seoKeywords =
  lang === 'es'
    ? [
        'Desarrollador Full-Stack',
        'React',
        'TypeScript',
        'Desarrollo Web',
        'UI/UX',
        'JavaScript',
        'Node.js',
        'Astro',
        'TailwindCSS',
        'Portafolio',
      ]
    : [
        'Full-Stack Developer',
        'React',
        'TypeScript',
        'Web Development',
        'UI/UX',
        'JavaScript',
        'Node.js',
        'Astro',
        'TailwindCSS',
        'Portfolio',
      ];

// Load Content Collections
const allProjects = await getCollection('projects');
const allBlogPosts = await getCollection('blog');
const allTestimonials = await getCollection('testimonials');

// Sort projects by order field, then by date
const sortedProjects = allProjects
  .sort((a, b) => {
    if (a.data.order !== b.data.order) {
      return a.data.order - b.data.order;
    }
    return b.data.publishDate.getTime() - a.data.publishDate.getTime();
  })
  .map((project) => ({
    title: project.data.title,
    description: project.data.description,
    tags: project.data.tags,
    image: project.data.image,
    demoUrl: project.data.demoUrl,
    codeUrl: project.data.codeUrl,
    featured: project.data.featured,
  }));

// Sort blog posts by date (newest first) and filter out drafts
const sortedBlogPosts = allBlogPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime())
  .map((post) => ({
    title: post.data.title,
    excerpt: post.data.excerpt,
    date: post.data.publishDate.toISOString().split('T')[0],
    readTime: post.data.readTime,
    tags: post.data.tags,
    slug: `/${lang}/blog/${post.slug}`,
  }));

// Sort testimonials by order and date
const sortedTestimonials = allTestimonials
  .sort((a, b) => {
    if (a.data.order !== b.data.order) {
      return a.data.order - b.data.order;
    }
    return b.data.date.getTime() - a.data.date.getTime();
  })
  .map((testimonial) => ({
    name: testimonial.data.name,
    role: testimonial.data.role,
    company: testimonial.data.company,
    content: testimonial.data.content,
    avatar: testimonial.data.avatar,
    linkedinUrl: testimonial.data.linkedinUrl,
    twitterUrl: testimonial.data.twitterUrl,
    source: testimonial.data.source,
  }));

// Translations for components
const heroTranslations = {
  iBuildText: t('home.hero.iBuildText'),
  viewProjects: t('home.hero.viewProjects'),
  getInTouch: t('home.hero.getInTouch'),
  downloadResume: t('home.hero.downloadResume'),
  scroll: t('home.hero.scroll'),
};

const heroAriaLabels = {
  github: t('aria.github'),
  linkedin: t('aria.linkedin'),
  fiverr: t('aria.fiverr'),
  upwork: t('aria.upwork'),
};

const aboutTranslations = {
  title: t('about.title'),
  subtitle: t('about.subtitle'),
  connect: t('about.connect'),
};

const skillsTranslations = {
  title: t('skills.title'),
  subtitle: t('skills.subtitle'),
  description: t('skills.description'),
  categoryTitles: {
    dev: t('skills.categories.dev'),
    design: t('skills.categories.design'),
    languages: t('skills.categories.languages'),
    tools: t('skills.categories.tools'),
  },
};

const projectsTranslations = {
  title: t('projects.title'),
  subtitle: t('projects.subtitle'),
  noProjects: t('projects.noProjects'),
  filterAll: t('projects.filterAll'),
};

const projectCardTranslations = {
  demo: t('projects.viewDemo'),
  code: t('projects.viewCode'),
  featured: t('projects.featured'),
};

const blogTranslations = {
  title: t('blog.title'),
  subtitle: t('blog.subtitle'),
  viewAll: t('blog.viewAll'),
  noArticles: t('blog.noArticles'),
  readMore: t('blog.readMore'),
  readTime: t('blog.readTime'),
};

const contactTranslations = {
  title: t('contact.title'),
  subtitle: t('contact.subtitle'),
  form: {
    name: t('contact.form.name'),
    email: t('contact.form.email'),
    subject: t('contact.form.subject'),
    message: t('contact.form.message'),
    send: t('contact.form.send'),
    sending: t('contact.form.sending'),
  },
  placeholders: {
    name: t('contact.placeholders.name'),
    email: t('contact.placeholders.email'),
    subject: t('contact.placeholders.subject'),
    message: t('contact.placeholders.message'),
  },
  errors: {
    nameRequired: t('contact.errors.nameRequired'),
    emailRequired: t('contact.errors.emailRequired'),
    emailInvalid: t('contact.errors.emailInvalid'),
    subjectRequired: t('contact.errors.subjectRequired'),
    messageRequired: t('contact.errors.messageRequired'),
    messageMinLength: t('contact.errors.messageMinLength'),
  },
  success: t('contact.success'),
  error: t('contact.error'),
};

const testimonialsTranslations = {
  title: t('testimonials.title'),
  subtitle: t('testimonials.subtitle'),
  noTestimonials: t('testimonials.noTestimonials'),
  readMore: t('testimonials.readMore'),
  readLess: t('testimonials.readLess'),
  viewProfile: t('testimonials.viewProfile'),
};

// Colors are now imported from data module
---

<BaseLayout
  title={title}
  description={description}
  imageAlt={t('seo.imageAlt')}
  type="profile"
  keywords={seoKeywords}
  author={t('profile.name')}
  jobTitle={t('profile.role')}
  socialLinks={{
    github: contact.social.github,
    linkedin: contact.social.linkedin,
    fiverr: contact.social.fiverr,
    upwork: contact.social.upwork,
  }}
>
  <!-- Hero Section (background with gradients) -->
  <div class="relative">
    <HeroSection
      primaryColor={sectionsColors.hero}
      name={t('profile.name')}
      iBuild={[
        t('home.iBuild.webapps'),
        t('home.iBuild.interfaces'),
        t('home.iBuild.solutions'),
        t('home.iBuild.experiences'),
        t('home.iBuild.uis'),
        t('home.iBuild.tools'),
      ]}
      roles={[t('home.roles.fullstack'), t('home.roles.frontend'), t('home.roles.designer')]}
      subtitle={t('home.hero.subtitle')}
      translations={heroTranslations}
      ariaLabels={heroAriaLabels}
    />
    <WaveDivider transition="hero-to-about" />
  </div>

  <!-- About Section with purple gradient background -->
  <div class="relative">
    <AboutSection
      primaryColor={sectionsColors.about}
      name={t('profile.name')}
      role={t('home.roles.fullstack')}
      location={contact.location}
      experience={t('profile.experience')}
      email={contact.email}
      availability={t('about.availability')}
      bio={t('about.bio')}
      lang={lang}
      translations={aboutTranslations}
    />
    <DiagonalDivider direction="mixed" transition="about-to-skills" />
  </div>

  <!-- Skills Section with indigo gradient background -->
  <div class="relative">
    <SkillsSection primaryColor={sectionsColors.skills} translations={skillsTranslations} />
    <WaveDivider transition="skills-to-projects" />
  </div>

  <!-- Projects Section with blue gradient background -->
  <div class="relative">
    <ProjectsSection
      primaryColor={sectionsColors.projects}
      projects={sortedProjects}
      translations={projectsTranslations}
      cardTranslations={projectCardTranslations}
    />
    <DiagonalDivider direction="right" transition="projects-to-blog" />
  </div>

  <!-- Blog Section with cyan gradient background -->
  <div class="relative">
    <BlogSection
      primaryColor={sectionsColors.blog}
      posts={sortedBlogPosts}
      translations={blogTranslations}
      lang={lang}
    />
    <DiagonalDivider direction="left" transition="blog-to-testimonials" />
  </div>

  <!-- Testimonials Section with purple gradient background -->
  <div class="relative">
    <TestimonialsSection
      primaryColor={sectionsColors.testimonials}
      testimonials={sortedTestimonials}
      translations={testimonialsTranslations}
    />
    <ZigzagDivider transition="testimonials-to-contact" />
  </div>

  <!-- Contact Section (normal background) -->
  <div class="relative">
    <Contact client:load primaryColor={sectionsColors.contact} translations={contactTranslations} />
    <DiagonalDivider direction="left" transition="contact-to-footer" />
  </div>
</BaseLayout>
