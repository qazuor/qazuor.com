---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { getCollection } from 'astro:content';
import photoFooter from '@/assets/images/photo-footer.png';
import PerformanceBadge from '@/components/ui/PerformanceBadge.astro';
import SocialLinks from '@/components/ui/SocialLinks.astro';
import { contact } from '@/data/contact';
import { getTranslations, processMarkdown } from '@/i18n/utils';

interface Props {
    lang?: 'en' | 'es';
}

const { lang = 'en' } = Astro.props;
const t = getTranslations(lang);

// Get latest blog posts (increased to 8)
const allBlogPosts = await getCollection('blog');
const latestPosts: CollectionEntry<'blog'>[] = allBlogPosts
    .filter((post: CollectionEntry<'blog'>) => !post.data.draft)
    .sort(
        (a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) =>
            b.data.publishDate.getTime() - a.data.publishDate.getTime()
    )
    .slice(0, 8);

// Navigation items with translated labels
const exploreItems = [
    { name: t('footer.explore.services'), url: `/${lang}/services` },
    { name: t('footer.explore.projects'), url: `/${lang}/projects` },
    { name: t('footer.explore.blog'), url: `/${lang}/blog` },
    { name: t('footer.explore.goodies'), url: `/${lang}/goodies` }
];

const currentYear = new Date().getFullYear();
---

<footer class="relative z-40 py-16 md:py-20" style="background-color: var(--section-footer-bg)">
    <div class="container-custom">
        <!-- Main Footer Content -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-10 mb-6 lg:mb-12">
            <!-- Branding / About with positioned image -->
            <div class="sm:col-span-2 relative">
                <h3 class="text-lg font-semibold text-foreground mb-4 lg:pl-64">
                    {t('footer.branding.title')}
                    <span class="text-foreground-muted">—</span>
                </h3>
                <p class="text-xs text-foreground-muted leading-relaxed lg:pl-64" set:html={processMarkdown(t('footer.branding.description'))} />
                <!-- Image positioned to extend to the bottom divider -->
                <Image
                    src={photoFooter}
                    alt={t('imageAlt.footerPhoto')}
                    width={280}
                    height={280}
                    class="hidden lg:block absolute left-0 -bottom-12 w-56 h-auto"
                />
            </div>

            <!-- Latest Posts -->
            <div class="space-y-4">
                <h3 class="text-lg font-semibold text-foreground">
                    {t('footer.latestPosts.title')}
                    <span class="text-foreground-muted">—</span>
                </h3>
                <ul class="space-y-2">
                    {
                        latestPosts.map((post) => (
                            <li>
                                <a
                                    href={`/${lang}/blog/${post.slug}`}
                                    class="text-xs text-foreground-muted hover:text-primary transition-colors duration-base line-clamp-1"
                                >
                                    {post.data.title}
                                </a>
                            </li>
                        ))
                    }
                    <li>
                        <a
                            href={`/${lang}/blog`}
                            class="text-xs text-primary hover:text-primary/80 transition-colors duration-base font-medium"
                        >
                            {t('footer.latestPosts.viewAll')} →
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Explore + Contact combined -->
            <div class="space-y-6">
                <!-- Explore / Navigation -->
                <div class="space-y-3">
                    <h3 class="text-lg font-semibold text-foreground">
                        {t('footer.explore.title')}
                        <span class="text-foreground-muted">—</span>
                    </h3>
                    <ul class="space-y-1">
                        {
                            exploreItems.map((item) => (
                                <li>
                                    <a
                                        href={item.url}
                                        class="text-xs text-foreground-muted hover:text-primary transition-colors duration-base"
                                    >
                                        {item.name}
                                    </a>
                                </li>
                            ))
                        }
                    </ul>
                </div>

                <!-- Contact -->
                <div class="space-y-3">
                    <h3 class="text-lg font-semibold text-foreground">
                        {t('footer.contact.title')}
                        <span class="text-foreground-muted">—</span>
                    </h3>
                    <div class="space-y-1">
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-foreground-muted">E:</span>
                            <a
                                href={`mailto:${contact.email}`}
                                class="text-xs text-foreground hover:text-primary transition-colors duration-base"
                            >
                                {contact.email}
                            </a>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-foreground-muted">P:</span>
                            <span class="text-xs text-foreground-muted">{contact.phone}</span>
                        </div>
                    </div>
                    <SocialLinks
                        ariaLabels={{
                            github: t('aria.github'),
                            linkedin: t('aria.linkedin'),
                            fiverr: t('aria.fiverr'),
                            upwork: t('aria.upwork'),
                            whatsapp: t('aria.whatsapp'),
                            mail: t('aria.mail'),
                            buymeacoffee: t('aria.buymeacoffee'),
                            discord: t('aria.discord'),
                            x: t('aria.x')
                        }}
                        size="sm"
                    />
                </div>
            </div>
        </div>

        <!-- Mobile Photo - positioned absolute, flipped -->
        <Image
            src={photoFooter}
            alt={t('imageAlt.footerPhoto')}
            width={180}
            height={180}
            class="lg:hidden absolute right-4 bottom-[239px] w-36 h-auto scale-x-[-1]"
        />

        <!-- Bottom Footer -->
        <div class="pt-8 border-t border-foreground/10">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <!-- Made with love - Left -->
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-foreground/10 flex items-center justify-center">
                        <span class="text-sm font-medium text-foreground">Q</span>
                    </div>
                    <span class="text-xs text-foreground-muted">
                        © {currentYear} Qazuor. {t('footer.madeWith')}
                    </span>
                </div>
                <!-- Performance stats - Right -->
                <PerformanceBadge
                    translations={{
                        title: t('footer.lighthouse.title'),
                        desktop: t('footer.lighthouse.desktop'),
                        mobile: t('footer.lighthouse.mobile'),
                        performance: t('footer.lighthouse.performance'),
                        accessibility: t('footer.lighthouse.accessibility'),
                        bestPractices: t('footer.lighthouse.bestPractices'),
                        seo: t('footer.lighthouse.seo'),
                        lcp: t('footer.lighthouse.lcp'),
                        cls: t('footer.lighthouse.cls'),
                        fcp: t('footer.lighthouse.fcp'),
                        source: t('footer.lighthouse.source'),
                        tooltips: {
                            performance: t('footer.lighthouse.tooltips.performance'),
                            accessibility: t('footer.lighthouse.tooltips.accessibility'),
                            bestPractices: t('footer.lighthouse.tooltips.bestPractices'),
                            seo: t('footer.lighthouse.tooltips.seo'),
                            lcp: t('footer.lighthouse.tooltips.lcp'),
                            cls: t('footer.lighthouse.tooltips.cls'),
                            fcp: t('footer.lighthouse.tooltips.fcp')
                        }
                    }}
                />
            </div>
        </div>
    </div>
</footer>

<style>
    /* Custom hover effects */
    footer a:hover {
        transform: translateY(-1px);
    }
</style>
