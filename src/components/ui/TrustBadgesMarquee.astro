---
/**
 * TrustBadgesMarquee Component (CSS-Only Version)
 *
 * Displays trust indicators with vertical slide animation.
 * Shows one badge at a time with smooth slide-up transitions.
 * Uses pure CSS animations - NO JavaScript DOM mutations.
 * All badges remain in DOM for SEO/LLM visibility.
 *
 * @example
 * <TrustBadgesMarquee
 *   badges={[
 *     { icon: 'clock', text: '20+ Years Experience' },
 *     { icon: 'globe', text: 'Remote Worldwide' }
 *   ]}
 * />
 */

import BriefcaseIcon from '@/icons/ui/briefcase.svg?raw';
import CheckIcon from '@/icons/ui/check.svg?raw';
import ClockIcon from '@/icons/ui/clock.svg?raw';
import CodeIcon from '@/icons/ui/code.svg?raw';
import GlobeIcon from '@/icons/ui/globe.svg?raw';
import LayoutIcon from '@/icons/ui/layout.svg?raw';
import MessageIcon from '@/icons/ui/message.svg?raw';
import RocketIcon from '@/icons/ui/rocket-launch.svg?raw';
import SearchIcon from '@/icons/ui/search.svg?raw';
import SmartphoneIcon from '@/icons/ui/smartphone.svg?raw';
import SparklesIcon from '@/icons/ui/sparkles.svg?raw';
import StarIcon from '@/icons/ui/star.svg?raw';
import UsersIcon from '@/icons/ui/users.svg?raw';
import ZapIcon from '@/icons/ui/zap.svg?raw';

// biome-ignore format: esbuild can't parse multiline union types in .astro files
export type TrustBadgeIcon = 'clock' | 'globe' | 'zap' | 'star' | 'users' | 'code' | 'smartphone' | 'search' | 'sparkles' | 'check' | 'message' | 'layout' | 'briefcase' | 'rocket';

export interface TrustBadge {
    /** Icon name */
    icon: TrustBadgeIcon;
    /** Badge text */
    text: string;
}

interface Props {
    /** Array of badges to display */
    badges: TrustBadge[];
    /** Additional CSS classes */
    className?: string;
    /** Duration each badge is shown (in seconds) */
    duration?: number;
}

const { badges, className = '', duration = 3 } = Astro.props;

const iconMap: Record<TrustBadgeIcon, string> = {
    clock: ClockIcon,
    globe: GlobeIcon,
    zap: ZapIcon,
    star: StarIcon,
    users: UsersIcon,
    code: CodeIcon,
    smartphone: SmartphoneIcon,
    search: SearchIcon,
    sparkles: SparklesIcon,
    check: CheckIcon,
    message: MessageIcon,
    layout: LayoutIcon,
    briefcase: BriefcaseIcon,
    rocket: RocketIcon
};

// Calculate animation timing
const totalBadges = badges.length;
const totalDuration = totalBadges * duration; // Total cycle time in seconds
const visiblePercent = (1 / totalBadges) * 100; // Percentage of time each badge is visible
const transitionPercent = 1; // 1% for enter/exit transitions
---

<div
    class:list={['trust-marquee-container relative overflow-hidden', className]}
    role="list"
    aria-label="Trust indicators"
    style={`--total-duration: ${totalDuration}s; --badge-count: ${totalBadges};`}
>
    <div class="trust-marquee-track">
        {
            badges.map((badge, index) => (
                <div
                    class="trust-marquee-item flex items-center justify-start gap-2 text-foreground-muted text-xs lg:text-sm"
                    role="listitem"
                    style={`--badge-index: ${index};`}
                >
                    <span
                        class="trust-badge-icon w-3.5 h-3.5 lg:w-4 lg:h-4 opacity-70 flex-shrink-0 [&>svg]:w-full [&>svg]:h-full"
                        aria-hidden="true"
                        set:html={iconMap[badge.icon]}
                    />
                    <span class="whitespace-nowrap">{badge.text}</span>
                </div>
            ))
        }
    </div>
</div>

<style define:vars={{ visiblePercent, transitionPercent }}>
    .trust-marquee-container {
        height: 24px;
    }

    @media (min-width: 1024px) {
        .trust-marquee-container {
            height: 28px;
        }
    }

    .trust-marquee-track {
        position: relative;
        height: 100%;
    }

    .trust-marquee-item {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        opacity: 0;
        transform: translateY(100%);
        /*
         * CSS-only animation using custom properties:
         * - Total duration comes from inline style
         * - Each badge calculates its delay based on index
         */
        animation: badge-cycle var(--total-duration) ease-in-out infinite;
        animation-delay: calc(var(--badge-index) * var(--total-duration) / var(--badge-count));
    }

    @keyframes badge-cycle {
        /* Start: hidden below */
        0% {
            opacity: 0;
            transform: translateY(100%);
        }
        /* Enter: slide up and fade in */
        1% {
            opacity: 1;
            transform: translateY(0);
        }
        /* Visible: stay in place */
        /* Exit point calculated as: (1 / badge-count) * 100 - transition */
        7.33% {
            opacity: 1;
            transform: translateY(0);
        }
        /* Exit: slide up and fade out */
        8.33% {
            opacity: 0;
            transform: translateY(-100%);
        }
        /* Hidden: stay hidden for rest of cycle */
        100% {
            opacity: 0;
            transform: translateY(-100%);
        }
    }

    /* Respect reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
        .trust-marquee-item {
            animation: none;
            opacity: 1;
            transform: translateY(0);
        }

        /* Only show first badge when reduced motion is preferred */
        .trust-marquee-item:not(:first-child) {
            display: none;
        }
    }
</style>
