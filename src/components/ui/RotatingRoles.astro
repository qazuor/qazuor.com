---
/**
 * RotatingRoles Component (CSS-Only Version)
 *
 * Displays rotating role titles with fade/scale animations.
 * Shows one role at a time with smooth transitions.
 * Uses pure CSS animations - NO JavaScript DOM mutations.
 * All roles remain in DOM for SEO/LLM visibility.
 *
 * @example
 * <RotatingRoles
 *   roles={['Full Stack Developer', 'Software Architect', 'Tech Lead']}
 * />
 */

interface Props {
    roles: string[];
    className?: string;
    /** Duration each role is shown (in seconds) */
    duration?: number;
}

const { roles, className = '', duration = 2.5 } = Astro.props;

// Calculate animation timing
const totalRoles = roles.length;
const totalDuration = totalRoles * duration; // Total cycle time in seconds
---

<div class={`absolute bottom-16 lg:bottom-20 left-1/2 -translate-x-1/2 ${className}`} style="z-index: 100;">
    <div
        class="rotating-roles-container text-sm lg:text-lg font-medium text-primary bg-background/90 backdrop-blur-md px-3 py-1.5 lg:px-4 lg:py-2 rounded-full border border-foreground/20 shadow-lg"
        style={`--total-duration: ${totalDuration}s; --role-count: ${totalRoles};`}
        aria-label={`Roles: ${roles.join(', ')}`}
    >
        {roles.map((role, index) => (
            <span
                class="rotating-role"
                style={`--role-index: ${index};`}
                aria-hidden={index > 0 ? "true" : undefined}
                set:html={role}
            />
        ))}
    </div>
</div>

<style>
    .rotating-roles-container {
        white-space: nowrap;
        min-height: 2.5rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        box-shadow:
            0 4px 15px rgba(var(--color-primary), 0.3),
            0 0 20px rgba(var(--color-primary), 0.1);
        animation: subtle-glow 3s ease-in-out infinite alternate;
    }

    /* Shine effect overlay */
    .rotating-roles-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: left 0.8s ease-in-out;
        z-index: 1;
    }

    /* Trigger shine on hover */
    .rotating-roles-container:hover::before {
        left: 100%;
    }

    .rotating-role {
        position: absolute;
        opacity: 0;
        transform: scale(0.95);
        /*
         * CSS-only animation using custom properties:
         * - Total duration comes from inline style
         * - Each role calculates its delay based on index
         */
        animation: role-cycle var(--total-duration) cubic-bezier(0.34, 1.56, 0.64, 1) infinite;
        animation-delay: calc(var(--role-index) * var(--total-duration) / var(--role-count));
    }

    /* First role takes up space for layout */
    .rotating-role:first-child {
        position: relative;
    }

    @keyframes role-cycle {
        /* Start: hidden and scaled down */
        0% {
            opacity: 0;
            transform: scale(0.95);
        }
        /* Enter: scale up with bounce effect */
        3% {
            opacity: 1;
            transform: scale(1);
        }
        /* Visible: stay in place */
        /* Exit point calculated as: (1 / role-count) * 100 - transition */
        20% {
            opacity: 1;
            transform: scale(1);
        }
        /* Exit: scale down and fade out */
        25% {
            opacity: 0;
            transform: scale(0.95);
        }
        /* Hidden: stay hidden for rest of cycle */
        100% {
            opacity: 0;
            transform: scale(0.95);
        }
    }

    @keyframes subtle-glow {
        from {
            box-shadow:
                0 4px 15px rgba(var(--color-primary), 0.3),
                0 0 20px rgba(var(--color-primary), 0.1);
        }
        to {
            box-shadow:
                0 4px 25px rgba(var(--color-primary), 0.4),
                0 0 30px rgba(var(--color-primary), 0.15);
        }
    }

    /* Respect reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
        .rotating-role {
            animation: none;
        }

        /* Only show first role when reduced motion is preferred */
        .rotating-role:first-child {
            opacity: 1;
            transform: scale(1);
        }

        .rotating-role:not(:first-child) {
            display: none;
        }

        .rotating-roles-container {
            animation: none;
        }
    }
</style>
