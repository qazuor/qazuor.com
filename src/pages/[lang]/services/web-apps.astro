---
import AnimatedGradientBackground from '@/components/ui/AnimatedGradientBackground.astro';
import SectionTitle from '@/components/ui/SectionTitle.astro';
import { sectionsColors } from '@/data';
import { services } from '@/data/services';
import { languages } from '@/i18n/ui';
import { getLangFromUrl, getTranslations } from '@/i18n/utils';
import BaseLayout from '@/layouts/BaseLayout.astro';

export function getStaticPaths() {
    return Object.keys(languages).map((lang) => ({
        params: { lang }
    }));
}

const lang = getLangFromUrl(Astro.url);
const t = getTranslations(lang);

// Get service data
const service = services.find((s) => s.slug === 'web-apps')!;

// SEO
const pageTitle = t(service.meta.titleKey);
const pageDescription = t(service.meta.descriptionKey);

// Service translations
const serviceTitle = t('services.webApps.title', { markdown: true });
const serviceDescription = t('services.webApps.descriptionExpanded');
const features = Array.from({ length: 9 }, (_, i) => t(`services.webApps.features.${i}`));
const pricingBreakdown = Array.from({ length: 3 }, (_, i) =>
    t(`services.webApps.pricing.breakdown.${i}`, { markdown: true })
);
const pricingFactors = Array.from({ length: 5 }, (_, i) => t(`services.webApps.pricing.factors.${i}`));
const faqs = Array.from({ length: 5 }, (_, i) => ({
    question: t(`services.webApps.faqs.${i}.question`),
    answer: t(`services.webApps.faqs.${i}.answer`)
}));

// Related services
const relatedServices = services
    .filter((s) => service.relatedServices.includes(s.id))
    .map((s) => {
        const serviceName =
            s.id === 'landing-pages'
                ? 'landingPages'
                : s.id === 'automation-integration'
                  ? 'automation'
                  : 'socialDesign';
        return {
            ...s,
            title: t(`services.${serviceName}.title`, { markdown: true }),
            description: t(`services.${serviceName}.description`)
        };
    });
---

<BaseLayout title={pageTitle} description={pageDescription}>
    <!-- Hero Section -->
    <section
        class="relative section overflow-hidden pt-32 pb-20"
        style={`background-color: ${service.themeColor}`}
    >
        <AnimatedGradientBackground />

        <div class="container-custom">
            <div class="max-w-4xl mx-auto text-center">
                <div class="text-6xl mb-6">{service.icon}</div>
                <h1 class="text-5xl md:text-6xl font-bold text-foreground mb-6" set:html={serviceTitle} />
                <p class="text-xl text-foreground-secondary leading-relaxed max-w-3xl mx-auto">
                    {serviceDescription}
                </p>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="relative section py-20 bg-background">
        <div class="container-custom">
            <SectionTitle
                title={t('services.featuresTitle', { markdown: true })}
                subtitle={t('services.featuresSubtitle')}
                size="lg"
            />

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-12">
                {features.map((feature) => (
                    <div class="flex items-start gap-3 p-6 rounded-lg bg-foreground/5 border border-foreground/10 hover:bg-foreground/10 transition-colors">
                        <svg class="w-6 h-6 text-primary flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        <span class="text-foreground">{feature}</span>
                    </div>
                ))}
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section class="relative section py-20" style={`background-color: ${service.themeColor}`}>
        <AnimatedGradientBackground />

        <div class="container-custom">
            <SectionTitle
                title={t('services.pricingTitle', { markdown: true })}
                subtitle={t('services.pricingSubtitle')}
                size="lg"
            />

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-12 max-w-5xl mx-auto">
                <!-- Pricing Breakdown -->
                <div class="bg-foreground/5 backdrop-blur-sm rounded-2xl p-8 border border-foreground/10">
                    <h3 class="text-2xl font-bold text-foreground mb-6" set:html={t('services.pricingRanges', { markdown: true })} />
                    <div class="space-y-4">
                        {pricingBreakdown.map((item) => (
                            <div class="flex items-center gap-3 text-foreground-secondary">
                                <svg class="w-5 h-5 text-primary flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                                <span set:html={item} />
                            </div>
                        ))}
                    </div>
                </div>

                <!-- Pricing Factors -->
                <div class="bg-foreground/5 backdrop-blur-sm rounded-2xl p-8 border border-foreground/10">
                    <h3 class="text-2xl font-bold text-foreground mb-6" set:html={t('services.pricingFactorsTitle', { markdown: true })} />
                    <div class="space-y-4">
                        {pricingFactors.map((factor) => (
                            <div class="flex items-start gap-3 text-foreground-secondary">
                                <svg class="w-5 h-5 text-secondary flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                </svg>
                                <span>{factor}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="relative section py-20 bg-background">
        <div class="container-custom">
            <SectionTitle
                title={t('services.faqTitle', { markdown: true })}
                subtitle={t('services.faqSubtitle')}
                size="lg"
            />

            <div class="max-w-3xl mx-auto mt-12 space-y-4">
                {faqs.map((faq, index) => (
                    <details class="group bg-foreground/5 rounded-lg border border-foreground/10 overflow-hidden">
                        <summary class="flex items-center justify-between px-6 py-4 cursor-pointer hover:bg-foreground/10 transition-colors">
                            <h3 class="text-lg font-semibold text-foreground pr-4">{faq.question}</h3>
                            <svg class="w-5 h-5 text-foreground-secondary group-open:rotate-180 transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </summary>
                        <div class="px-6 pb-4 text-foreground-secondary leading-relaxed">
                            {faq.answer}
                        </div>
                    </details>
                ))}
            </div>
        </div>
    </section>

    <!-- Related Services Section -->
    {relatedServices.length > 0 && (
        <section class="relative section py-20" style={`background-color: ${service.themeColor}`}>
            <AnimatedGradientBackground />

            <div class="container-custom">
                <SectionTitle
                    title={t('services.relatedServices.title')}
                    size="lg"
                />

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-12 max-w-4xl mx-auto">
                    {relatedServices.map((related) => (
                        <a
                            href={`/${lang}/services/${related.slug}`}
                            class="group bg-foreground/5 backdrop-blur-sm rounded-2xl p-6 border border-foreground/10 hover:bg-foreground/10 hover:border-foreground/20 transition-all"
                        >
                            <div class="flex items-start gap-4">
                                <span class="text-4xl">{related.icon}</span>
                                <div class="flex-1">
                                    <h3 class="text-xl font-bold text-foreground mb-2 group-hover:text-primary transition-colors" set:html={related.title} />
                                    <p class="text-foreground-secondary text-sm">{related.description}</p>
                                </div>
                                <svg class="w-5 h-5 text-foreground-secondary group-hover:text-primary group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </div>
                        </a>
                    ))}
                </div>
            </div>
        </section>
    )}

    <!-- CTA Section -->
    <section class="relative section py-20 bg-background">
        <div class="container-custom">
            <div class="max-w-3xl mx-auto text-center bg-foreground/5 backdrop-blur-sm rounded-2xl p-12 border border-foreground/10">
                <h2 class="text-3xl font-bold text-foreground mb-4" set:html={t('services.cta.title', { markdown: true })} />
                <p class="text-foreground-secondary text-lg mb-8" set:html={t('services.cta.description', { markdown: true })} />

                <a
                    href={`/${lang}/contact`}
                    class="inline-flex items-center px-8 py-4 bg-primary text-white font-semibold rounded-lg hover:bg-primary-dark transition-colors text-lg"
                >
                    <span set:html={t('services.cta.button', { markdown: true })} />
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.959 8.959 0 01-4.906-1.478L3 21l2.478-5.094A8.959 8.959 0 013 12c0-4.418 3.582-8 8-8s8 3.582 8 8z" />
                    </svg>
                </a>

                <div class="flex items-center justify-center gap-2 mt-6 text-foreground-secondary text-sm">
                    <svg class="w-4 h-4 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                    </svg>
                    <span set:html={t('services.cta.consultation', { markdown: true })} />
                </div>
            </div>
        </div>
    </section>
</BaseLayout>
