---
/**
 * ProjectJsonLd Component
 * Renders structured data for project/portfolio pages
 *
 * Includes:
 * - CreativeWork/SoftwareApplication schema with technologies, links
 * - BreadcrumbList for navigation
 *
 * @example
 * <ProjectJsonLd
 *   lang="en"
 *   name="My Project"
 *   description="A project description"
 *   url="https://qazuor.com/en/projects/my-project"
 *   image="https://qazuor.com/images/project.jpg"
 *   datePublished="2024-01-15"
 *   technologies={["React", "TypeScript"]}
 *   githubUrl="https://github.com/user/project"
 *   demoUrl="https://demo.example.com"
 * />
 */
import type { BreadcrumbListSchema, CreativeWorkSchema } from '@/types/jsonld';
import JsonLd from './JsonLd.astro';

interface Props {
    lang: string;
    name: string;
    description: string;
    url: string;
    image?: string;
    datePublished: Date;
    technologies?: string[];
    githubUrl?: string;
    demoUrl?: string;
    publicUrl?: string;
    category?: string;
}

const {
    lang,
    name,
    description,
    url,
    image,
    datePublished,
    technologies = [],
    githubUrl,
    demoUrl,
    publicUrl,
    category
} = Astro.props;

const SITE_URL = 'https://qazuor.com';

// Determine the best @type based on category
const getSchemaType = (): 'SoftwareApplication' | 'WebApplication' | 'CreativeWork' => {
    if (category === 'open-source') return 'SoftwareApplication';
    if (category === 'commercial' || category === 'client') return 'WebApplication';
    return 'CreativeWork';
};

// Build CreativeWork/SoftwareApplication schema
const projectSchema: CreativeWorkSchema = {
    '@context': 'https://schema.org',
    '@type': getSchemaType(),
    name: name,
    description: description,
    url: publicUrl || demoUrl || url,
    datePublished: datePublished.toISOString(),
    author: {
        '@type': 'Person',
        name: 'Julian Cataldo'
    },
    ...(image && { image: image }),
    ...(technologies.length > 0 && { keywords: technologies }),
    ...(githubUrl && {
        about: 'Open Source Software',
        applicationCategory: 'DeveloperApplication'
    }),
    ...(category && { applicationCategory: category })
};

// Build Breadcrumb schema
const breadcrumbSchema: BreadcrumbListSchema = {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: [
        {
            '@type': 'ListItem',
            position: 1,
            name: lang === 'es' ? 'Inicio' : 'Home',
            item: `${SITE_URL}/${lang}`
        },
        {
            '@type': 'ListItem',
            position: 2,
            name: lang === 'es' ? 'Proyectos' : 'Projects',
            item: `${SITE_URL}/${lang}/projects`
        },
        {
            '@type': 'ListItem',
            position: 3,
            name: name
        }
    ]
};

// Combine all schemas
const schemas = [projectSchema, breadcrumbSchema];
---

<JsonLd schema={schemas} />
