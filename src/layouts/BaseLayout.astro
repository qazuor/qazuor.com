---
import { CommandPalette, ScrollToTop, SmoothScroll } from '../components';
import Navigation from '../components/Navigation.astro';
import SEO from '../components/SEO.astro';
import { languages } from '../i18n/ui';
import { getLangFromUrl, getRouteFromUrl, getTranslations } from '../i18n/utils';
import githubIcon from '../icons/social/github.svg?raw';
import twitterIcon from '../icons/social/twitter.svg?raw';

interface Props {
  title: string;
  description?: string;
  image?: string;
  imageAlt?: string;
  type?: 'website' | 'article' | 'profile';
  keywords?: string[];
  publishDate?: string;
  modifiedDate?: string;
  articleTags?: string[];
  noindex?: boolean;
}

const lang = getLangFromUrl(Astro.url);
const t = getTranslations(lang);

const {
  title,
  description = t('home.description'),
  image,
  imageAlt,
  type = 'website',
  keywords = [],
  publishDate,
  modifiedDate,
  articleTags = [],
  noindex = false,
} = Astro.props;
const currentYear = new Date().getFullYear();

// Get current route without locale
const route = getRouteFromUrl(Astro.url);

// Generate alternate language links
const locales = Object.keys(languages);
const alternateLinks = locales.map((locale) => {
  const path = `/${locale}${route}`;
  return { locale, path };
});
---

<!doctype html>
<html lang={lang} class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO Component -->
    <SEO
      title={title}
      description={description}
      image={image}
      imageAlt={imageAlt}
      type={type}
      keywords={keywords}
      locale={lang}
      publishDate={publishDate}
      modifiedDate={modifiedDate}
      articleTags={articleTags}
      noindex={noindex}
    />

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Alternate language links -->
    {alternateLinks.map(({ locale, path }) => (
      <link rel="alternate" hreflang={locale} href={`${Astro.site || ''}${path}`} />
    ))}

    <!-- Prevent flash of unstyled content (FOUC) for dark mode -->
    <script is:inline>
      const theme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (theme === 'dark' || (!theme && prefersDark)) {
        document.documentElement.classList.add('dark');
      } else if (theme === 'light') {
        document.documentElement.classList.remove('dark');
      }
    </script>
  </head>
  <body>
    <!-- Smooth Scroll Integration -->
    <SmoothScroll client:only="react" />

    <!-- Command Palette (Ctrl+K) -->
    <CommandPalette
      client:only="react"
      lang={lang}
      ariaLabel={t('aria.closeCommandPalette')}
      placeholder={t('aria.commandPalettePlaceholder')}
    />

    <!-- Scroll to Top Button -->
    <ScrollToTop client:load ariaLabel={t('aria.scrollToTop')} />

    <Navigation />

    <main class="min-h-screen">
      <slot />
    </main>

    <footer class="bg-background-secondary border-t border-foreground/10">
      <div class="container-custom py-8">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
          <p class="text-sm text-foreground-secondary">
            Â© {currentYear} qazuor.com. {t('footer.rights')}.
          </p>
          <div class="flex gap-4">
            <a
              href="https://github.com/qazuor"
              target="_blank"
              rel="noopener noreferrer"
              class="text-foreground-secondary hover:text-foreground transition-colors duration-base"
              aria-label={t('aria.github')}
              set:html={githubIcon}
            />
            <a
              href="https://twitter.com/qazuor"
              target="_blank"
              rel="noopener noreferrer"
              class="text-foreground-secondary hover:text-foreground transition-colors duration-base"
              aria-label={t('aria.twitter')}
              set:html={twitterIcon}
            />
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>

<style is:global>
  @import '../styles/global.css';
</style>
